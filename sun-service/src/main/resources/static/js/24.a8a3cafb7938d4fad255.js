webpackJsonp([24],{"CC/3":function(t,a){},USWZ:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("C19g"),i=e("fBob"),r={props:{indexValue:[String,Number],maxValue:[String,Number],unit:[String]},mounted:function(){this.maxValue&&this.indexValue?this.$data.width=this.indexValue/this.maxValue*100:this.$data.width=0},data:function(){return{width:0}}},l={render:function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"process-outer"},[a("div",{staticClass:"process-inner",style:"width:"+this.width+"%"}),this._v(" "),a("span",{staticClass:"process-title"},[this._v(this._s(this.indexValue)+this._s(this.unit||""))])])},staticRenderFns:[]};var n=e("VU/8")(r,l,!1,function(t){e("CC/3")},"data-v-fc4e0312",null).exports,d=e("mQwn"),o=e.n(d),h=e("zE6V"),v=e.n(h),c=e("P9l9"),m={components:{messLineChart:s.a,rateLineChart:i.a,processCom:n},created:function(){var t=this;this.getNodes(),this.$data.nodeIntervale=setInterval(function(){t.getNodes()},3e4)},data:function(){return{messageParam:{beginTime:"",endTime:""},showDetail:!1,nodeImgData:[],serverRunImg:o.a,serverUnRunImg:v.a,defaultArea:"gz",overViewInterval:null,nodeIntervale:null,chartType:"hour",worldImg:"url("+e("uC/s")+")",messageChar:{title:"队列消息：",xAxis:[],series:[]},rateChar:{title:"讯息率：",xAxis:[],series:[]},totalMessage:{},nodeData:[],listenTable:[],webTable:[],downloadDefname:null}},beforeRouteLeave:function(t,a,e){clearInterval(this.$data.nodeIntervale),clearInterval(this.$data.overViewInterval),e()},methods:{getOverview:function(){var t=this;this.$post(c.a.rabbitMq.getOverviewDetails,{area:this.$data.defaultArea,chartType:this.$data.chartType},function(a){a.success?"hour"==t.$data.chartType||"day"==t.$data.chartType?(t.listenTable=a.listeners,t.webTable=a.contexts,t.totalMessage=a.object_totals,t.drawMessChar(a),t.drawRateMess(a)):("week"==t.$data.chartType?(t.$data.messageChar.series=[],t.$data.rateChar.series=[],t.$data.messageChar.xAxis=a.timelist,t.$data.rateChar.xAxis=a.timelist,t.$data.messageChar.series.push({title:"总数",data:a.totalList}),t.$data.messageChar.series.push({title:"已就绪",data:a.readyList}),t.$data.messageChar.series.push({title:"未确认",data:a.unackList}),t.$data.rateChar.series.push({title:"待确认",data:a.confirmRateList}),t.$data.rateChar.series.push({title:"发布",data:a.publishRateList}),t.$data.rateChar.series.push({title:"推送",data:a.deliverRateList}),t.$data.rateChar.series.push({title:"确认",data:a.ackRateList})):"month"==t.$data.chartType&&(t.$data.messageChar.series=[],t.$data.rateChar.series=[],t.$data.messageChar.xAxis=a.timelist,t.$data.rateChar.xAxis=a.timelist,t.$data.messageChar.series.push({title:"总数",data:a.totalList}),t.$data.messageChar.series.push({title:"已就绪",data:a.readyList}),t.$data.messageChar.series.push({title:"未确认",data:a.unackList}),t.$data.rateChar.series.push({title:"待确认",data:a.confirmRateList}),t.$data.rateChar.series.push({title:"发布",data:a.publishRateList}),t.$data.rateChar.series.push({title:"推送",data:a.deliverRateList}),t.$data.rateChar.series.push({title:"确认",data:a.ackRateList})),t.$refs.messageLineChart.drawCharts(),t.$refs.rateLineChart.drawCharts()):t.$message.error("获取概述信息失败")})},drawMessChar:function(t){var a=this,e=[];this.$data.messageChar.xAxis=[],this.$data.messageChar.series=[],t.queue_totals.messages_details.samples.forEach(function(t,s){0!=s&&("hour"==a.$data.chartType&&a.$data.messageChar.xAxis.push(new Date(t.timestamp).Format("hh:mm")),"day"==a.$data.chartType&&a.$data.messageChar.xAxis.push(new Date(t.timestamp).Format("hh:00")),e.push(t.sample))}),this.$data.messageChar.xAxis=this.$data.messageChar.xAxis.reverse(),this.$data.messageChar.series.push({title:"总数",data:e.reverse()});var s=[];t.queue_totals.messages_ready_details.samples.forEach(function(t){s.push(t.sample)}),this.$data.messageChar.series.push({title:"已就绪",data:s.reverse()});var i=[];t.queue_totals.messages_unacknowledged_details.samples.forEach(function(t){i.push(t.sample)}),this.$data.messageChar.series.push({title:"未确认",data:i.reverse()}),this.$refs.messageLineChart.drawCharts()},drawRateMess:function(t){console.log("rate...............");var a=[];this.$data.rateChar.xAxis=[],this.$data.rateChar.series=[],console.log(t.message_stats);var e=t.message_stats.confirm_details.samples;if(e){for(var s=1;s<=e.length-1;s++){"hour"==this.$data.chartType&&this.$data.rateChar.xAxis.push(new Date(e[s].timestamp).Format("hh:mm")),"day"==this.$data.chartType&&this.$data.rateChar.xAxis.push(new Date(e[s].timestamp).Format("hh:00")),"week"==this.$data.chartType&&this.$data.rateChar.xAxis.push(new Date(e[s].timestamp).Format("yyyy-MM-dd")),"month"==this.$data.chartType&&this.$data.rateChar.xAxis.push(new Date(e[s].timestamp).Format("yyyy-MM-dd"));var i=(1e3*(e[s-1].sample-e[s].sample)/(e[s-1].timestamp-e[s].timestamp)).toFixed(4);a.push(i)}this.$data.rateChar.series.push({title:"待确认",data:a.reverse()}),this.$data.rateChar.xAxis=this.$data.rateChar.xAxis.reverse()}if(t.message_stats.publish_details){var r=t.message_stats.publish_details.samples,l=[];for(s=1;s<=r.length-1;s++){var n=(1e3*(r[s-1].sample-r[s].sample)/(r[s-1].timestamp-r[s].timestamp)).toFixed(4);l.push(n)}this.$data.rateChar.series.push({title:"发布",data:l.reverse()})}if(t.message_stats.deliver_details){var d=t.message_stats.deliver_details.samples,o=[];for(s=1;s<=d.length-1;s++){var h=(1e3*(d[s-1].sample-d[s].sample)/(d[s-1].timestamp-d[s].timestamp)).toFixed(4);o.push(h)}this.$data.rateChar.series.push({title:"推送",data:o.reverse()})}if(t.message_stats.ack_details){var v=t.message_stats.ack_details.samples,c=[];for(s=1;s<=v.length-1;s++){var m=(1e3*(v[s-1].sample-v[s].sample)/(v[s-1].timestamp-v[s].timestamp)).toFixed(4);c.push(m)}this.$data.rateChar.series.push({title:"确认",data:c.reverse()}),console.log(this.$data.rateChar),this.$refs.rateLineChart.drawCharts()}console.log("this..",this.$data.rateChar),this.$refs.rateLineChart.drawCharts()},getNodes:function(){var t=this;this.$post(c.a.rabbitMq.getNodeInfo,{},function(a){if(a.success){for(var e=0;e<a.data.length;e++)t.$data.defaultArea==a.data[e].area&&(t.$data.nodeData=a.data[e].serverList);t.nodeImgData=a.data}else t.$message.error("获取集群信息失败！")})},handleShowDetail:function(t){this.$data.defaultArea=t,c.a.defaultArea=t,this.$data.downloadDefname="rabbitmq_"+this.$data.defaultArea+"_"+(new Date).Format("yyyy-MM-dd")+".json",this.$data.overViewInterval&&clearInterval(this.$data.overViewInterval),this.getOverview(),this.$data.showDetail=!0},downloadDef:function(){var t=this;this.$post(c.a.rabbitMq.downloadDef,{area:this.$data.defaultArea},function(a){if(a.success){var e="http://"+a.address+":15672/api/definitions?download="+encodeURIComponent(t.$data.downloadDefname)+"&auth="+a.auth;console.log("path",e),window.location=e}else t.$message.error("下载失败")})},handleBackMain:function(){this.$data.overViewInterval&&clearInterval(this.$data.overViewInterval),this.$data.showDetail=!1},fmt_uptime:function(t){var a=Math.floor(t/1e3),e=a%60,s=Math.floor(a/60)%60,i=Math.floor(a/3600)%24,r=Math.floor(a/86400);return r>0?r+"d "+i+"h":i>0?i+"h "+s+"m":s+"m "+e+"s"}}},p={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"over-page"},[t.showDetail?[e("div",{staticClass:"message-overView"},[e("div",{staticClass:"head-content"},[e("span",[t._v("队列信息概述")]),t._v(" "),e("div",{staticClass:"timearea-select"},[e("el-select",{staticClass:"send-select",attrs:{placeholder:"请选择"},on:{change:t.getOverview},model:{value:t.chartType,callback:function(a){t.chartType=a},expression:"chartType"}},[e("el-option",{attrs:{value:"hour",label:"最近一小时"}}),t._v(" "),e("el-option",{attrs:{value:"day",label:"最近一天"}}),t._v(" "),e("el-option",{attrs:{value:"week",label:"最近一周"}}),t._v(" "),e("el-option",{attrs:{value:"month",label:"最近一个月"}})],1)],1),t._v(" "),e("span",{staticClass:"head-righttitle"},[e("span",{staticClass:"back-main",on:{click:t.handleBackMain}},[e("span",{staticClass:"iconfont i-back"},[t._v("")]),t._v(" "),e("span",[t._v("返回拓扑图")])])])]),t._v(" "),e("div",{staticClass:"message-content"},[e("div",{staticClass:"chart-content"},[e("mess-line-chart",{ref:"messageLineChart",attrs:{id:"message-list",width:"100%",height:"320",echartsData:t.messageChar}})],1),t._v(" "),e("div",{staticClass:"chart-content"},[e("rate-line-chart",{ref:"rateLineChart",attrs:{id:"message-rate",width:"100%",height:"320",echartsData:t.rateChar}})],1)])]),t._v(" "),e("div",{staticClass:"total-overview"},[t._m(1),t._v(" "),e("div",{staticClass:"total-content"},[e("div",{staticClass:"total-item"},[e("span",{staticClass:"total-itemname"},[t._v("连接")]),t._v(" "),e("span",{staticClass:"total-itemvalue"},[t._v(t._s(t.totalMessage.connections))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",{staticClass:"total-itemname"},[t._v("信道")]),t._v(" "),e("span",{staticClass:"total-itemvalue"},[t._v(t._s(t.totalMessage.channels))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",{staticClass:"total-itemname"},[t._v("交换器")]),t._v(" "),e("span",{staticClass:"total-itemvalue"},[t._v(t._s(t.totalMessage.exchanges))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",{staticClass:"total-itemname"},[t._v("队列")]),t._v(" "),e("span",{staticClass:"total-itemvalue"},[t._v(t._s(t.totalMessage.queues))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",{staticClass:"total-itemname"},[t._v("消费者")]),t._v(" "),e("span",{staticClass:"total-itemvalue"},[t._v(t._s(t.totalMessage.consumers))])])])]),t._v(" "),e("div",{staticClass:"node-overview"},[t._m(2),t._v(" "),e("div",{staticClass:"node-content"},[e("div",{staticClass:"node-tablehead"},[e("table",{staticClass:"node-table"},[t._m(3),t._v(" "),t._l(t.nodeData,function(a,s){return e("tr",{key:s},[a.running?[e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"120px"}},[t._v(t._s(a.name))])]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"130px"}},[e("process-com",{attrs:{indexValue:a.fd_used}})],1)]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"150px"}},[e("process-com",{attrs:{indexValue:a.sockets_used}})],1)]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"130px"}},[e("process-com",{attrs:{indexValue:a.proc_used}})],1)]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"130px"}},[e("process-com",{attrs:{unit:"MB",indexValue:parseInt(a.mem_used/1048576),maxValue:a.mem_limit}})],1)]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"130px"}},[e("process-com",{attrs:{unit:"MB",indexValue:parseInt(a.disk_free/1048576),maxValue:a.disk_free_limit}})],1)]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"120px"}},[t._v(t._s(t.fmt_uptime(a.uptime)))])]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"130px"}},[t._v(t._s(a.rates_mode))])]),t._v(" "),e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"160px"}},[t._v(t._s(a.type))])])]:[e("td",[e("div",{staticClass:"rabbit-name rabbit-value",staticStyle:{"min-width":"120px"}},[t._v(t._s(a.name))])]),t._v(" "),t._m(4,!0)]],2)})],2)])])]),t._v(" "),e("div",{staticClass:"prot-overview"},[t._m(5),t._v(" "),e("div",{staticClass:"prot-content"},[e("div",{staticClass:"listen-port"},[e("div",{staticClass:"listen-head"},[t._v("Listening ports")]),t._v(" "),e("el-table",{attrs:{data:t.listenTable,border:""}},[e("el-table-column",{attrs:{prop:"protocol",label:"Protocol","min-width":"170"}}),t._v(" "),e("el-table-column",{attrs:{prop:"node",label:"Node","min-width":"170"}}),t._v(" "),e("el-table-column",{attrs:{prop:"ip_address",label:"Bound to","min-width":"190"}}),t._v(" "),e("el-table-column",{attrs:{prop:"port",label:"Port","min-width":"190"}})],1)],1),t._v(" "),e("div",{staticClass:"listen-port"},[e("div",{staticClass:"listen-head"},[t._v("Web contexts")]),t._v(" "),e("el-table",{attrs:{data:t.webTable,border:""}},[e("el-table-column",{attrs:{prop:"description",label:"Context","min-width":"170"}}),t._v(" "),e("el-table-column",{attrs:{prop:"node",label:"node","min-width":"190"}}),t._v(" "),e("el-table-column",{attrs:{prop:"port",label:"Port","min-width":"190"}}),t._v(" "),e("el-table-column",{attrs:{prop:"path",label:"Path","min-width":"190"}})],1)],1)])]),t._v(" "),e("div",{staticClass:"export-setting"},[t._m(6),t._v(" "),e("div",{staticClass:"head-content"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.downloadDefname,expression:"downloadDefname"}],attrs:{type:"text"},domProps:{value:t.downloadDefname},on:{input:function(a){a.target.composing||(t.downloadDefname=a.target.value)}}}),t._v(" "),e("button",{on:{click:t.downloadDef}},[t._v("下载")])])])]:[e("div",{staticClass:"node-img",style:{backgroundImage:t.worldImg}},[t._m(0),t._v(" "),e("div",{staticClass:"node-list"},[t._l(t.nodeImgData,function(a,s){return[e("div",{key:s+"server",staticClass:"node-item"},[e("div",{staticClass:"node-address"},[t._v(t._s("gz"==a.area?"广州":"上海"))]),t._v(" "),e("div",{staticClass:"nodeimg-content"},[t._l(a.serverList,function(s,i){return[e("div",{key:i+"img",class:"nodeimg"+i,on:{click:function(e){return t.handleShowDetail(a.area)}}},[e("div",{staticClass:"server-name"},[t._v(t._s(s.name))]),t._v(" "),e("el-tooltip",{attrs:{placement:"right",effect:"light"}},[e("div",{attrs:{slot:"content"},slot:"content"},[e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("名称：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(s.name))])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("磁盘可用空间：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(parseInt(s.disk_free/1024))+"MB")])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("磁盘低位告警值：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(parseInt(s.disk_free_limit/1024))+"MB")])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("磁盘是否告警：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(s.disk_free_alarm?"是":"否"))])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("内存可用空间：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(parseInt(s.mem_used/1024))+"MB")])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("内存高位告警值：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(parseInt(s.mem_limit/1024)))])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("内存是否告警：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(s.mem_alarm?"是":"否"))])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("运行状态：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(s.running?"运行中":"已停止"))])]),t._v(" "),e("div",{staticClass:"tip-item"},[e("span",{staticClass:"tip-title"},[t._v("运行时间：")]),t._v(" "),e("span",{staticClass:"tip-value"},[t._v(t._s(t.fmt_uptime(s.uptime)))])])]),t._v(" "),e("img",{attrs:{src:s.running?t.serverRunImg:t.serverUnRunImg}})])],1),t._v(" "),e("div",{key:i+"line",class:"nodeimg-line"+i,style:s.running?"background:green;":"background:red;"})]})],2)]),t._v(" "),s!=t.nodeImgData.length-1?e("div",{key:s+"line",staticClass:"node-line"}):t._e()]})],2)])]],2)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"head-content"},[a("span",{staticClass:"head-title"},[this._v("节点拓扑图")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"head-content"},[a("span",{staticClass:"head-title"},[this._v("全局计数")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"head-content"},[a("span",{staticClass:"head-title"},[this._v("节点")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("tr",[e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"120px"}},[t._v("名称")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"130px"}},[t._v("File descriptors")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"150px"}},[t._v("Socket descriptors")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"130px"}},[t._v("启动的进程数")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"130px"}},[t._v("内存(MB)")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"130px"}},[t._v("硬盘(MB)")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"120px"}},[t._v("运行时长")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"130px"}},[t._v("Rates模式")])]),t._v(" "),e("th",[e("div",{staticClass:"rabbit-name rabbit-title",staticStyle:{"min-width":"160px"}},[t._v("Info")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("td",{attrs:{colspan:"8"}},[a("div",{staticClass:"rabbit-noruning"},[this._v("Node not running")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"head-content"},[a("span",{staticClass:"head-title"},[this._v("端口和上下文")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"head-content"},[a("span",{staticClass:"head-title"},[this._v("导出设置")])])}]};var _=e("VU/8")(m,p,!1,function(t){e("a8eG")},"data-v-1e1c3804",null);a.default=_.exports},a8eG:function(t,a){}});